<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>ğŸ’µè‚¡ç¥ğŸ“ˆ</title>
	<style>
		#shopModal { z-index: 1000; }
		#tradeModal { z-index: 1001; }
		.max-button {
			background: #f1c40f !important;
			padding: 10px 15px !important;
			margin-left: 5px;
		}
		.input-group {
			display: flex;
			align-items: center;
			gap: 8px;
			margin: 10px 0;
		}

		:root {
			--rise-color: #e74c3c;
			--fall-color: #2ecc71;
			--primary-color: #3498db;
			--background: #ecf0f1;
			--redeem-color: #9b59b6;
			--sell-color: #e67e22;
		}

		body {
			margin: 0;
			padding: 10px;
			background: var(--background);
		}

		.container {
			max-width: 500px;
			margin: 0 auto;
		}

		.card {
			background: white;
			border-radius: 10px;
			padding: 15px;
			margin-bottom: 10px;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}

		.stock-item, .shop-item {
			position: relative;
			padding: 15px;
			margin: 8px 0;
			background: white;
			border-radius: 8px;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}

		.trend-icon {
			font-size: 1.2em;
			position: absolute;
			right: 15px;
			top: 15px;
		}

		.button {
			padding: 10px 15px;
			border: none;
			border-radius: 20px;
			background: var(--primary-color);
			color: white;
			cursor: pointer;
			margin: 5px;
		}

		.modal {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0,0,0,0.5);
			display: none;
			justify-content: center;
			align-items: center;
			z-index: 1000;
		}

		.modal-content {
			background: white;
			padding: 20px;
			border-radius: 10px;
			width: 90%;
			max-width: 400px;
		}

		.income-badge {
			background: #27ae60;
			color: white;
			padding: 2px 8px;
			border-radius: 10px;
			font-size: 0.9em;
		}
	</style>
</head>
<body>
	<!-- ç™»å½•ç•Œé¢ -->
	<div id="loginView" class="container">
		<div class="card">
			<h2>ğŸ’µè‚¡ç¥ğŸ“ˆ</h2>
			<input type="text" id="username" placeholder="ç”¨æˆ·å" style="width:100%; padding:10px; margin:5px 0;">
			<input type="password" id="password" placeholder="å¯†ç " style="width:100%; padding:10px; margin:5px 0;">
			<button class="button" onclick="login()">ç™»å½•</button>
			<button class="button" onclick="register()">æ³¨å†Œ</button>
		</div>
	</div>

	<!-- ä¸»ç•Œé¢ -->
	<div id="mainView" class="container" style="display:none;">
		<div class="card">
			<h2>æˆ‘çš„èµ„äº§ ğŸ’°</h2>
			<div id="userBalance">ä½™é¢ï¼š$10000.00</div>
			<div id="totalStockValue" style="margin:5px 0; color:#e67e22;"></div>
			<div style="margin-top:10px;">
				<button class="button" onclick="showRedeem()">å…‘æ¢ç  ğŸ</button>
				<button class="button" onclick="showShop()">å•†åŸ ğŸª</button>
				<button class="button" onclick="showHistory()">è®°å½• ğŸ“œ</button>
			</div>
			<div id="portfolioList"></div>
		</div>

		<div class="card">
			<h2>è‚¡ç¥¨å¸‚åœº ğŸ“Š</h2>
			<div id="stockList"></div>
		</div>
	</div>

	<!-- äº¤æ˜“å¼¹çª— -->
	<div id="tradeModal" class="modal">
		<div class="modal-content">
			<h3 id="tradeTitle"></h3>
			<p id="stockPrice"></p>
			<p id="availableBalance" style="color:#666; font-size:0.9em;"></p>
			<div class="input-group">
				<input type="number" id="tradeAmount" min="1" value="1" 
					   style="flex:1; padding:10px;">
				<button class="button max-button" onclick="setMaxAmount()">Max</button>
			</div>
			<div>
				<button class="button" onclick="confirmTrade()">ç¡®è®¤</button>
				<button class="button" onclick="closeModal()">å–æ¶ˆ</button>
			</div>
		</div>
	</div>

	<!-- äº¤æ˜“å†å²å¼¹çª— -->
	<div id="historyModal" class="modal">
		<div class="modal-content">
			<h3>äº¤æ˜“è®°å½• ğŸ“œ</h3>
			<div id="historyList" style="max-height:400px; overflow-y:auto;"></div>
			<button class="button" onclick="closeHistory()" style="margin-top:10px;">å…³é—­</button>
		</div>
	</div>

	<!-- å•†åŸå¼¹çª— -->
	<div id="shopModal" class="modal">
		<div class="modal-content">
			<h3>èµ„äº§å•†åŸ ğŸ¬</h3>
			<div id="shopItemsList" style="max-height:60vh; overflow-y:auto;"></div>
			<button class="button" onclick="closeShop()" style="margin-top:10px;">å…³é—­</button>
		</div>
	</div>

	<!-- å…‘æ¢ç å¼¹çª— -->
	<div id="redeemModal" class="modal">
		<div class="modal-content">
			<h3>å…‘æ¢å¥–åŠ±ç  ğŸ«</h3>
			<input type="text" id="redeemCode" 
				   placeholder="è¾“å…¥å…‘æ¢ç "
				   style="width:100%; padding:10px; margin:10px 0;">
			<div>
				<button class="button" onclick="redeemCode()">å…‘æ¢</button>
				<button class="button" onclick="closeRedeem()">å…³é—­</button>
			</div>
		</div>
	</div>

	<script>
	// è‚¡ç¥¨æ•°æ®åˆå§‹åŒ–
	let stocks = [
		{ name: "é™¶æ°ç§‘æŠ€ğŸ’¾", price: 15000, capital: 1.5e11, trend: 0 },
		{ name: "ç”Ÿç‰©åŒ»è¯ğŸ§ª", price: 680, capital: 6.8e8, trend: 0 },
		{ name: "é™¶æ°æ–°èƒ½æºğŸ”‹", price: 1500, capital: 1.5e10, trend: 0 },
		{ name: "é™¶æ°é‡‘èğŸ¦", price: 8000, capital: 8e10, trend: 1 },
		{ name: "åª’ä½“ç½‘ç»œğŸ›œ", price: 60, capital: 6e8, trend: 0 },
		{ name: "é™¶æ°åœ°äº§ğŸ¡", price: 100000, capital: 1e12, trend: 0 },
		{ name: "é™¶æ°æ—¶å°šğŸ‘—", price: 8, capital: 8e7, trend: 0 },
		{ name: "æ—…æ¸¸å¤©åœ°ğŸ•ï¸", price: 110, capital: 1.1e9, trend: 0 },
		{ name: "é£Ÿå“å›½é™…ğŸ±", price: 45, capital: 4.5e8, trend: 0 },
		{ name: "é™¶æ°åŒ»è¯ğŸ§¬", price: 5000, capital: 5e10, trend: 0 }
	];

	// å•†åŸå•†å“æ•°æ®
	const shopItems = [
		{ name: 'æ™®é€šæ±½è½¦å…¬å¸', price: 10000, income: 1, emoji: 'ğŸš—', desc: 'åŸºç¡€ä»£æ­¥å·¥å…·' },
		{ name: 'ä¸­ç­‰æ±½è½¦å…¬å¸', price: 200000, income: 25, emoji: 'ğŸš™', desc: 'èˆ’é€‚å‡ºè¡Œä½“éªŒ' },
		{ name: 'é«˜çº§æ±½è½¦å…¬å¸', price: 3000000, income: 650, emoji: 'ğŸš', desc: 'èº«ä»½çš„è±¡å¾' },
		{ name: 'é™¶æ°è±ªåæ±½è½¦å…¬å¸', price: 30000000, income: 7000, emoji: 'ğŸï¸', desc: 'é™¶æ°è´µæ—çš„è±¡å¾' },
		{ name: 'Tsaoå¥¶èŒ¶åº—', price: 300000, income: 40, emoji: 'ğŸ§‹', desc: 'å¥¶èŒ¶è¿é”å“ç‰Œ' },
		{ name: '98Kæ±‰å ¡åº—', price: 500000, income: 80, emoji: 'ğŸ”', desc: 'æ±‰å ¡è¿é”å“ç‰Œ' },
		{ name: 'ä¸­å›½å·èœåº—', price: 1000000, income: 200, emoji: 'ğŸ¥˜', desc: 'å·èœè¿é”å“ç‰Œ' },
		{ name: 'é™¶æ°6æ˜Ÿç±³å…¶æ—é¤é¥®å…¬å¸', price: 100000000, income: 30000, emoji: 'ğŸ·ğŸ´', desc: 'é™¶æ°è¿é”å“ç‰Œ' },
		{ name: 'æ™®é€šæˆ¿åœ°äº§å…¬å¸', price: 600000, income: 100, emoji: 'ğŸšï¸', desc: 'æ™®é€šä½å®…' },
		{ name: 'ä¸­ç­‰æˆ¿åœ°äº§å…¬å¸', price: 2000000, income: 450, emoji: 'ğŸ ', desc: 'æ¸©é¦¨ä½å®…' },
		{ name: 'é«˜çº§æˆ¿åœ°äº§å…¬å¸', price: 5000000, income: 1200, emoji: 'ğŸ ', desc: 'è±ªåå±…ä½ä½“éªŒ' },
		{ name: 'é™¶æ°å¤§åˆ«å¢…åœ°äº§å…¬å¸', price: 60000000, income: 15000, emoji: 'ğŸ¡', desc: 'é™¶æ°è´µæ—å¤§åˆ«å¢…' }
	];

	// ç”¨æˆ·ç³»ç»Ÿ
	let currentUser = null;
	let currentUsername = null;
	let currentTrade = null;
	let currentSellItem = null;

	// å…‘æ¢ç æ•°æ®
	const rewardCodes = {
		"WELCOME": { amount: 10000 },
		"MILLIONAIRE": { amount: 1000000 },
		"DANIELTAO": { amount: 10000000 },
		"RICH2025": { amount: 20250 },
		"TAOSTOCK": { amount: 100000 }
	};

	function getUsers() {
		return JSON.parse(localStorage.getItem('users')) || {};
	}

	function saveUsers(users) {
		localStorage.setItem('users', JSON.stringify(users));
	}

	function saveUser() {
		const users = getUsers();
		users[currentUsername] = currentUser;
		saveUsers(users);
	}

	function loadUser(username) {
		const users = getUsers();
		return users[username] ? {
			password: users[username].password,
			balance: users[username].balance,
			portfolio: users[username].portfolio || {},
			properties: users[username].properties || {},
			history: users[username].history || [],
			redeemedCodes: users[username].redeemedCodes || []
		} : null;
	}

	// æ³¨å†ŒåŠŸèƒ½
	function register() {
		const username = document.getElementById('username').value.trim();
		const password = document.getElementById('password').value.trim();
		
		if (!username || !password) {
			alert('ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©ºï¼');
			return;
		}
		
		const users = getUsers();
		if (users.hasOwnProperty(username)) {
			alert('ç”¨æˆ·åå·²å­˜åœ¨ï¼');
			return;
		}
		
		currentUser = {
			password: password,
			balance: 10000,
			portfolio: {},
			properties: {},
			history: [],
			redeemedCodes: []
		};
		
		currentUsername = username;
		saveUser();
		alert('æ³¨å†ŒæˆåŠŸï¼è‡ªåŠ¨ç™»å½•');
		login();
	}

	// ç™»å½•åŠŸèƒ½
	function login() {
		const username = document.getElementById('username').value.trim();
		const password = document.getElementById('password').value.trim();
		
		const users = getUsers();
		if (!users[username]) {
			alert('ç”¨æˆ·ä¸å­˜åœ¨ï¼');
			return;
		}
		
		if (users[username].password !== password) {
			alert('å¯†ç é”™è¯¯ï¼');
			return;
		}
		
		currentUsername = username;
		currentUser = loadUser(username);
		
		document.getElementById('loginView').style.display = 'none';
		document.getElementById('mainView').style.display = 'block';
		updateDisplay();
		setInterval(updateStockPrices, 1000);
		startIncomeTimer();
	}

	// è‚¡ç¥¨ä»·æ ¼æ›´æ–°
	function updateStockPrices() {
		stocks.forEach(stock => {
			const previousPrice = stock.price;
			stock.price = stock.price * (0.95 + Math.random() * 0.1);
			stock.price = Math.round(stock.price * 100) / 100;
			stock.trend = stock.price > previousPrice ? 1 : -1;
			stock.capital = stock.capital * (0.98 + Math.random() * 0.04);
			stock.capital = Math.round(stock.capital);
		});
		renderStocks();
		renderPortfolio();
	}

	// è‚¡ç¥¨ç•Œé¢æ¸²æŸ“
	function renderStocks() {
		const container = document.getElementById('stockList');
		container.innerHTML = stocks.map(stock => `
			<div class="stock-item">
				<div class="trend-icon">
					${stock.trend > 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'}
					<span style="color:${stock.trend > 0 ? 'var(--rise-color)' : 'var(--fall-color)'}">
						$${stock.price.toFixed(2)}
					</span>
				</div>
				<h3>${stock.name}</h3>
				<div>å¸‚å€¼ï¼š$${stock.capital.toLocaleString()}</div>
				<div style="margin-top:10px;">
					<button class="button" onclick="showTrade('${stock.name}', 'buy')">ä¹°å…¥</button>
					<button class="button" onclick="showTrade('${stock.name}', 'sell')">å–å‡º</button>
				</div>
			</div>
		`).join('');
	}

	// èµ„äº§æ˜¾ç¤ºï¼ˆå«è‚¡ç¥¨æ€»èµ„äº§ï¼‰
	function renderPortfolio() {
		const container = document.getElementById('portfolioList');
		let totalStockValue = 0;

		const stockContent = Object.keys(currentUser.portfolio).map(stockName => {
			const shares = currentUser.portfolio[stockName];
			const stock = stocks.find(s => s.name === stockName);
			const value = shares * stock.price;
			totalStockValue += value;
			return `
				<div class="card" style="margin:5px 0; padding:10px;">
					<div>${stockName}ï¼šæŒæœ‰ ${shares} è‚¡</div>
					<div>å½“å‰ä»·å€¼ï¼š$${value.toFixed(2)}</div>
				</div>
			`;
		}).join('');

		document.getElementById('totalStockValue').textContent = 
			`è‚¡ç¥¨æ€»èµ„äº§ï¼š$${totalStockValue.toFixed(2)}`;

		const propertyContent = `
			<div class="card" style="margin:10px 0; background:#f9f9f9;">
				<h3>è¢«åŠ¨æ”¶å…¥ ğŸ’¸</h3>
				${Object.keys(currentUser.properties).map(itemName => {
					const item = shopItems.find(i => i.name === itemName);
					return `
						<div style="padding:5px 0;">
							${item.emoji} ${itemName} x${currentUser.properties[itemName]} 
							($${item.income * currentUser.properties[itemName]}/ç§’)
						</div>
					`;
				}).join('') || "<div>æš‚æ— èµ„äº§</div>"}
			</div>
		`;

		container.innerHTML = (stockContent || "<div>æš‚æ— è‚¡ç¥¨æŒä»“</div>") + propertyContent;
	}

	// äº¤æ˜“åŠŸèƒ½
	function showTrade(stockName, type) {
		currentTrade = { stock: stockName, type };
		currentSellItem = null;
		const stock = stocks.find(s => s.name === stockName);
		document.getElementById('tradeTitle').textContent = `${type === 'buy' ? 'ä¹°å…¥' : 'å–å‡º'} ${stockName}`;
		document.getElementById('stockPrice').textContent = `å½“å‰ä»·æ ¼ï¼š$${stock.price.toFixed(2)}`;
		
		if (type === 'buy') {
			document.getElementById('availableBalance').textContent = `å¯ç”¨ç°é‡‘ï¼š$${currentUser.balance.toFixed(2)}`;
		} else {
			const held = currentUser.portfolio[stockName] || 0;
			document.getElementById('availableBalance').textContent = `å¯ç”¨æŒä»“ï¼š${held} è‚¡`;
		}
		
		document.getElementById('tradeModal').style.display = 'flex';
		document.getElementById('tradeAmount').value = 1;
	}

	// MaxæŒ‰é’®åŠŸèƒ½
	function setMaxAmount() {
		if (currentTrade) {
			if (currentTrade.type === 'buy') {
				const stock = stocks.find(s => s.name === currentTrade.stock);
				const maxShares = Math.floor(currentUser.balance / stock.price);
				document.getElementById('tradeAmount').value = maxShares > 0 ? maxShares : 1;
			} else if (currentTrade.type === 'sell') {
				const held = currentUser.portfolio[currentTrade.stock] || 0;
				document.getElementById('tradeAmount').value = held;
			}
		} else if (currentSellItem) {
			const held = currentUser.properties[currentSellItem] || 0;
			document.getElementById('tradeAmount').value = held;
		}
	}

	// èµ„äº§å‡ºå”®åŠŸèƒ½
	function showSell(itemName) {
		currentSellItem = itemName;
		currentTrade = null;
		const item = shopItems.find(i => i.name === itemName);
		document.getElementById('tradeTitle').textContent = `å‡ºå”® ${itemName}`;
		document.getElementById('stockPrice').textContent = `å‡ºå”®ä»·æ ¼ï¼š$${(item.price * 0.9).toFixed(2)}ï¼ˆåŸä»·90%ï¼‰`;
		const held = currentUser.properties[itemName] || 0;
		document.getElementById('availableBalance').textContent = `å¯ç”¨æ•°é‡ï¼š${held}`;
		document.getElementById('tradeModal').style.display = 'flex';
		document.getElementById('tradeAmount').value = 1;
	}

	function confirmTrade() {
		if (currentTrade) {
			const stock = stocks.find(s => s.name === currentTrade.stock);
			const amount = parseInt(document.getElementById('tradeAmount').value);
			
			if (currentTrade.type === 'buy') {
				const cost = amount * stock.price;
				if (cost > currentUser.balance) {
					alert('èµ„é‡‘ä¸è¶³ï¼');
					return;
				}
				currentUser.balance -= cost;
				currentUser.portfolio[stock.name] = (currentUser.portfolio[stock.name] || 0) + amount;
			} else {
				if (!currentUser.portfolio[stock.name] || currentUser.portfolio[stock.name] < amount) {
					alert('æŒä»“ä¸è¶³ï¼');
					return;
				}
				currentUser.balance += amount * stock.price;
				currentUser.portfolio[stock.name] -= amount;
				if (currentUser.portfolio[stock.name] === 0) {
					delete currentUser.portfolio[stock.name];
				}
			}

			currentUser.history.push({
				type: currentTrade.type,
				stock: stock.name,
				amount,
				price: stock.price,
				time: new Date().toLocaleString()
			});
		} else if (currentSellItem) {
			const item = shopItems.find(i => i.name === currentSellItem);
			const amount = parseInt(document.getElementById('tradeAmount').value);
			const owned = currentUser.properties[currentSellItem] || 0;

			if (amount < 1) {
				alert('å‡ºå”®æ•°é‡è‡³å°‘ä¸º1ï¼');
				return;
			}
			
			if (owned < amount) {
				alert('æŒæœ‰æ•°é‡ä¸è¶³ï¼');
				return;
			}

			const sellValue = Math.floor(item.price * 0.9 * amount);
			currentUser.balance += sellValue;
			currentUser.properties[currentSellItem] -= amount;
			
			if (currentUser.properties[currentSellItem] === 0) {
				delete currentUser.properties[currentSellItem];
			}

			currentUser.history.push({
				type: 'sell',
				item: currentSellItem,
				amount: amount,
				price: item.price * 0.9,
				time: new Date().toLocaleString()
			});
		}

		saveUser();
		updateDisplay();
		closeModal();
		if (currentSellItem) showShop();
	}

	// å•†åŸç³»ç»Ÿ
	function showShop() {
		const container = document.getElementById('shopItemsList');
		container.innerHTML = shopItems.map(item => {
			const owned = currentUser.properties[item.name] || 0;
			return `
				<div class="shop-item">
					<div style="display:flex; justify-content:space-between;">
						<div>
							<h3>${item.emoji} ${item.name}</h3>
							<div style="color:#666; font-size:0.9em;">${item.desc}</div>
						</div>
						<div style="text-align:right;">
							<div>$${item.price.toLocaleString()}</div>
							<div class="income-badge">+$${item.income}/ç§’</div>
						</div>
					</div>
					<div style="margin-top:10px;">
						${owned > 0 ? `
						<button class="button" 
								onclick="showSell('${item.name}')"
								style="background:var(--sell-color);">
							å‡ºå”®
						</button>` : ''}
						<button class="button" 
								onclick="buyItem('${item.name}')"
								style="background:#2ecc71;">
							è´­ä¹°
						</button>
						<span>å·²æŒæœ‰ï¼š${owned}</span>
					</div>
				</div>
			`;
		}).join('');
		document.getElementById('shopModal').style.display = 'flex';
	}

	function buyItem(itemName) {
		const item = shopItems.find(i => i.name === itemName);
		
		if (currentUser.balance < item.price) {
			alert('èµ„é‡‘ä¸è¶³ï¼');
			return;
		}

		if (confirm(`ç¡®è®¤èŠ±è´¹ $${item.price.toLocaleString()} è´­ä¹° ${itemName} å—ï¼Ÿ`)) {
			currentUser.balance -= item.price;
			currentUser.properties[itemName] = (currentUser.properties[itemName] || 0) + 1;
			
			currentUser.history.push({
				type: 'buy',
				item: itemName,
				price: item.price,
				time: new Date().toLocaleString()
			});

			saveUser();
			updateDisplay();
			showShop();
		}
	}

	// è¢«åŠ¨æ”¶å…¥ç³»ç»Ÿ
	function startIncomeTimer() {
		setInterval(() => {
			let totalIncome = 0;
			Object.keys(currentUser.properties).forEach(itemName => {
				const item = shopItems.find(i => i.name === itemName);
				totalIncome += item.income * currentUser.properties[itemName];
			});
			currentUser.balance += totalIncome;
			saveUser();
			updateDisplay();
		}, 1000);
	}

	// å…‘æ¢ç ç³»ç»Ÿ
	function showRedeem() {
		document.getElementById('redeemModal').style.display = 'flex';
		document.getElementById('redeemCode').value = '';
	}

	function closeRedeem() {
		document.getElementById('redeemModal').style.display = 'none';
	}

	function redeemCode() {
		const code = document.getElementById('redeemCode').value.trim().toUpperCase();
		
		if (!code) {
			alert('è¯·è¾“å…¥å…‘æ¢ç ï¼');
			return;
		}
		
		if (currentUser.redeemedCodes.includes(code)) {
			alert('è¯¥å…‘æ¢ç å·²ä½¿ç”¨è¿‡ï¼');
			return;
		}
		
		const reward = rewardCodes[code];
		
		if (!reward) {
			alert('æ— æ•ˆçš„å…‘æ¢ç ï¼');
			return;
		}
		
		currentUser.balance += reward.amount;
		currentUser.redeemedCodes.push(code);
		
		currentUser.history.push({
			type: 'redeem',
			code: code,
			amount: reward.amount,
			time: new Date().toLocaleString()
		});
		
		saveUser();
		updateDisplay();
		alert(`æˆåŠŸå…‘æ¢ $${reward.amount}ï¼`);
		closeRedeem();
	}

	// äº¤æ˜“è®°å½•æ˜¾ç¤º
	function showHistory() {
		const container = document.getElementById('historyList');
		container.innerHTML = currentUser.history.map(record => {
			let content = '';
			if (record.type === 'redeem') {
				content = `
					<div style="color:var(--redeem-color);">
						ğŸ« å…‘æ¢ç ï¼š${record.code}
					</div>
					<div>è·å¾—é‡‘é¢ï¼š+$${record.amount.toFixed(2)}</div>
				`;
			} else if (record.item) {
				if (record.type === 'buy') {
					content = `
						<div style="color:var(--rise-color);">
							ğŸª è´­ä¹° ${record.item}
						</div>
						<div>èŠ±è´¹ï¼š$${record.price.toFixed(2)}</div>
					`;
				} else {
					content = `
						<div style="color:var(--sell-color);">
							ğŸª å‡ºå”® ${record.item}
						</div>
						<div>æ•°é‡ï¼š${record.amount}</div>
						<div>å•ä»·ï¼š$${record.price.toFixed(2)}</div>
						<div>è·å¾—é‡‘é¢ï¼š+$${(record.amount * record.price).toFixed(2)}</div>
					`;
				}
			} else {
				content = `
					<div style="color:${record.type === 'buy' ? 'var(--rise-color)' : 'var(--fall-color)'}">
						${record.type === 'buy' ? 'ğŸ“ˆ ä¹°å…¥' : 'ğŸ“‰ å–å‡º'} ${record.stock}
					</div>
					<div>æ•°é‡ï¼š${record.amount} è‚¡</div>
					<div>å•ä»·ï¼š$${record.price.toFixed(2)}</div>
					<div>æ€»é‡‘é¢ï¼š$${(record.amount * record.price).toFixed(2)}</div>
				`;
			}
			return `
				<div class="card" style="margin:5px 0; padding:10px; 
					background:${getRecordBackground(record)}">
					${content}
					<div style="font-size:0.8em; color:#666;">${record.time}</div>
				</div>
			`;
		}).reverse().join('') || "<div>æš‚æ— è®°å½•</div>";
		document.getElementById('historyModal').style.display = 'flex';
	}

	function getRecordBackground(record) {
		if (record.type === 'redeem') return '#f5e8ff';
		if (record.type === 'buy') return record.item ? '#f8e5e5' : '#fee';
		if (record.type === 'sell') return '#fdebd0';
		return '#e5f8f0';
	}

	// é€šç”¨åŠŸèƒ½
	function closeModal() {
		document.getElementById('tradeModal').style.display = 'none';
		currentTrade = null;
		currentSellItem = null;
	}

	function closeShop() {
		document.getElementById('shopModal').style.display = 'none';
	}

	function closeHistory() {
		document.getElementById('historyModal').style.display = 'none';
	}

	function updateDisplay() {
		document.getElementById('userBalance').textContent = 
			`ä½™é¢ï¼š$${currentUser.balance.toFixed(2)}`;
		renderPortfolio();
	}

	// åˆå§‹åŒ–
	document.getElementById('loginView').style.display = 'block';
	document.getElementById('mainView').style.display = 'none';
	</script>
</body>
</html>
